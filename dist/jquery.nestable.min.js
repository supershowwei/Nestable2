!function(h,d,c,i){var n="ontouchstart"in c,p=function(){var t=c.createElement("div"),e=c.documentElement;if(!("pointerEvents"in t.style))return!1;t.style.pointerEvents="auto",t.style.pointerEvents="x",e.appendChild(t);var s=d.getComputedStyle&&"auto"===d.getComputedStyle(t,"").pointerEvents;return e.removeChild(t),!!s}(),s={contentCallback:function(t){return t.content||t.id},listNodeName:"ol",itemNodeName:"li",handleNodeName:"div",contentNodeName:"span",rootClass:"dd",listClass:"dd-list",itemClass:"dd-item",dragClass:"dd-dragel",handleClass:"dd-handle",contentClass:"dd-content",collapsedClass:"dd-collapsed",placeClass:"dd-placeholder",noDragClass:"dd-nodrag",noChildrenClass:"dd-nochildren",emptyClass:"dd-empty",expandBtnHTML:'<button class="dd-expand" data-action="expand" type="button">Expand</button>',collapseBtnHTML:'<button class="dd-collapse" data-action="collapse" type="button">Collapse</button>',group:0,maxDepth:5,threshold:20,fixedDepth:!1,fixed:!1,includeContent:!1,moveOut:!0,scroll:!1,scrollSensitivity:1,scrollSpeed:5,scrollTriggers:{top:40,left:40,right:-40,bottom:-40},effect:{animation:"none",time:"slow"},callback:function(t,e,s){},onDragStart:function(t,e,s){},beforeDragStop:function(t,e,s){},listRenderer:function(t,e){var s="<"+e.listNodeName+' class="'+e.listClass+'">';return s+=t,s+="</"+e.listNodeName+">"},itemRenderer:function(t,e,s,i,o){t=h.map(t,function(t,e){return" "+e+'="'+t+'"'}).join(" "),t="<"+i.itemNodeName+t+">";return t+="<"+i.handleNodeName+' class="'+i.handleClass+'">',t+="<"+i.contentNodeName+' class="'+i.contentClass+'">',t+=e,t+="</"+i.contentNodeName+">",t+="</"+i.handleNodeName+">",t+=s,t+="</"+i.itemNodeName+">"}};function l(t,e){this.w=h(c),this.el=h(t),(e=e||s).rootClass!==i&&"dd"!==e.rootClass&&(e.listClass=e.listClass||e.rootClass+"-list",e.itemClass=e.itemClass||e.rootClass+"-item",e.dragClass=e.dragClass||e.rootClass+"-dragel",e.handleClass=e.handleClass||e.rootClass+"-handle",e.collapsedClass=e.collapsedClass||e.rootClass+"-collapsed",e.placeClass=e.placeClass||e.rootClass+"-placeholder",e.noDragClass=e.noDragClass||e.rootClass+"-nodrag",e.noChildrenClass=e.noChildrenClass||e.rootClass+"-nochildren",e.emptyClass=e.emptyClass||e.rootClass+"-empty"),this.options=h.extend({},s,e),this.options.json!==i&&this._build(),this.init()}l.prototype={init:function(){var i=this;i.reset(),i.el.data("nestable-group",this.options.group),i.placeEl=h('<div class="'+i.options.placeClass+'"/>');var t=this.el.find(i.options.itemNodeName);h.each(t,function(t,e){var s=h(e),e=s.parent();i.setParent(s),e.hasClass(i.options.collapsedClass)&&i.collapseItem(e.parent())}),t.length||this.appendEmptyElement(this.el),i.el.on("click","button",function(t){var e;i.dragEl||(t=(e=h(t.currentTarget)).data("action"),e=e.parents(i.options.itemNodeName).eq(0),"collapse"===t&&i.collapseItem(e),"expand"===t&&i.expandItem(e))});function e(t){var e=h(t.target);if(!e.hasClass(i.options.handleClass)){if(e.closest("."+i.options.noDragClass).length)return;e=e.closest("."+i.options.handleClass)}e.length&&!i.dragEl&&(i.isTouch=/^touch/.test(t.type),i.isTouch&&1!==t.touches.length||(t.preventDefault(),i.dragStart(t.touches?t.touches[0]:t)))}function s(t){i.dragEl&&(t.preventDefault(),i.dragMove(t.touches?t.touches[0]:t))}function o(t){i.dragEl&&(t.preventDefault(),i.dragStop(t.touches?t.changedTouches[0]:t))}n&&(i.el[0].addEventListener("touchstart",e,!1),d.addEventListener("touchmove",s,!1),d.addEventListener("touchend",o,!1),d.addEventListener("touchcancel",o,!1)),i.el.on("mousedown",e),i.w.on("mousemove",s),i.w.on("mouseup",o);i.el.bind("destroy-nestable",function(){n&&(i.el[0].removeEventListener("touchstart",e,!1),d.removeEventListener("touchmove",s,!1),d.removeEventListener("touchend",o,!1),d.removeEventListener("touchcancel",o,!1)),i.el.off("mousedown",e),i.w.off("mousemove",s),i.w.off("mouseup",o),i.el.off("click"),i.el.unbind("destroy-nestable"),i.el.data("nestable",null)})},destroy:function(){this.el.trigger("destroy-nestable")},add:function(t){var e="."+this.options.listClass,s=h(this.el).children(e);t.parent_id!==i&&(s=s.find('[data-id="'+t.parent_id+'"]'),delete t.parent_id,0===s.children(e).length&&(s=s.append(this.options.listRenderer("",this.options))),s=s.find(e+":first"),this.setParent(s.parent())),s.append(this._buildItem(t,this.options))},replace:function(t){var e=this._buildItem(t,this.options);this._getItemById(t.id).replaceWith(e)},removeItem:function(t){var e=this.options,s=this.el;(t=t||this).remove();t="."+e.listClass+" ."+e.listClass+":not(:has(*))";h(s).find(t).remove();h(s).find('[data-action="expand"], [data-action="collapse"]').each(function(){0===h(this).siblings("."+e.listClass).length&&h(this).remove()})},remove:function(t,e){var s=this.options,i=this,o=this._getItemById(t),t=s.effect.animation||"fade",s=s.effect.time||"slow";"fade"===t?o.fadeOut(s,function(){i.removeItem(o)}):this.removeItem(o),e&&e()},removeAll:function(t){var e=this,s=this.options,i=e.el.find(s.listNodeName).first(),o=i.children(s.itemNodeName),n=s.effect.animation||"fade",s=s.effect.time||"slow";function l(){o.each(function(){e.removeItem(h(this))}),i.show(),t&&t()}"fade"===n?i.fadeOut(s,l):l()},_getItemById:function(t){return h(this.el).children("."+this.options.listClass).find('[data-id="'+t+'"]')},_build:function(){var t=this.options.json;"string"==typeof t&&(t=JSON.parse(t)),h(this.el).html(this._buildList(t,this.options))},_buildList:function(t,s){if(!t)return"";var i="",o=this;return h.each(t,function(t,e){i+=o._buildItem(e,s)}),s.listRenderer(i,s)},_buildItem:function(t,e){var s,i,o=function(t){delete(t=h.extend({},t)).children,delete t.classes,delete t.content;var i={};return h.each(t,function(t,e){var s;"object"==typeof e&&(e=JSON.stringify(e)),i["data-"+t]=(s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"},e+"".replace(/[&<>"']/g,function(t){return s[t]}))}),i}(t);o.class=(i=e,"string"==typeof(s=(s=t).classes||{})&&(s=[s]),(s=function(t){var e,s={};for(e in t)s[t[e]]=t[e];return s}(s))[i.itemClass]=i.itemClass,h.map(s,function(t){return t}).join(" "));var n=e.contentCallback(t),l=this._buildList(t.children,e),e=h(e.itemRenderer(o,n,l,e,t));return this.setParent(e),e[0].outerHTML},serialize:function(){var o=this,n=function(t){var i=[];return t.children(o.options.itemNodeName).each(function(){var t=h(this),e=h.extend({},t.data()),s=t.children(o.options.listNodeName);!o.options.includeContent||(t=t.find("."+o.options.contentClass).html())&&(e.content=t),s.length&&(e.children=n(s)),i.push(e)}),i};return n(o.el.find(o.options.listNodeName).first())},asNestedSet:function(){var l=this.options,a=[],t=1;return this.el.find(l.listNodeName).first().children(l.itemNodeName).each(function(){t=function t(e,s,i){var o,n=i+1;0<h(e).children(l.listNodeName).children(l.itemNodeName).length&&(s++,h(e).children(l.listNodeName).children(l.itemNodeName).each(function(){n=t(h(this),s,n)}),s--);o=h(e).attr("data-id");r(o)&&(o=parseInt(o));e=h(e).parent(l.listNodeName).parent(l.itemNodeName).attr("data-id")||"";r(e)&&(e=parseInt(e));o&&a.push({id:o,parent_id:e,depth:s,lft:i,rgt:n});i=n+1;return i}(this,0,t)}),a=a.sort(function(t,e){return t.lft-e.lft});function r(t){return h.isNumeric(t)&&Math.floor(t)==t}},returnOptions:function(){return this.options},serialise:function(){return this.serialize()},toHierarchy:function(t){var o=h.extend({},this.options,t),e=[];return h(this.element).children(o.items).each(function(){var t=function e(t){var s=(h(t).attr(o.attribute||"id")||"").match(o.expression||/(.+)[-=_](.+)/);if(s){var i={id:s[2]};return 0<h(t).children(o.listType).children(o.items).length&&(i.children=[],h(t).children(o.listType).children(o.items).each(function(){var t=e(this);i.children.push(t)})),i}}(this);e.push(t)}),e},toArray:function(){var a=h.extend({},this.options,this),r=a.startDepthCount||0,d=[],t=2;return this.el.find(this.options.listNodeName).first().children(this.options.itemNodeName).each(function(){t=function t(e,s,i){var o,n=i+1;0<e.children(a.options.listNodeName).children(a.options.itemNodeName).length&&(s++,e.children(a.options.listNodeName).children(a.options.itemNodeName).each(function(){n=t(h(this),s,n)}),s--);o=e.data().id;{var l;l=s===r+1?a.rootID:(l=e.parent(a.options.listNodeName).parent(a.options.itemNodeName).data(),l.id)}o&&d.push({id:o,parent_id:l,depth:s,left:i,right:n});i=n+1;return i}(h(this),r+1,t)}),d=d.sort(function(t,e){return t.left-e.left})},reset:function(){this.mouse={offsetX:0,offsetY:0,startX:0,startY:0,lastX:0,lastY:0,nowX:0,nowY:0,distX:0,distY:0,dirAx:0,dirX:0,dirY:0,lastDirX:0,lastDirY:0,distAxX:0,distAxY:0},this.isTouch=!1,this.moving=!1,this.dragEl=null,this.dragRootEl=null,this.dragParentEl=null,this.dragDepth=0,this.hasNewRoot=!1,this.pointEl=null},expandItem:function(t){t.removeClass(this.options.collapsedClass)},collapseItem:function(t){t.children(this.options.listNodeName).length&&t.addClass(this.options.collapsedClass)},expandAll:function(){var t=this;t.el.find(t.options.itemNodeName).each(function(){t.expandItem(h(this))})},collapseAll:function(){var t=this;t.el.find(t.options.itemNodeName).each(function(){t.collapseItem(h(this))})},setParent:function(t){t.is(this.options.itemNodeName)&&t.children(this.options.listNodeName).length&&(t.children("[data-action]").remove(),t.prepend(h(this.options.expandBtnHTML)),t.prepend(h(this.options.collapseBtnHTML)))},unsetParent:function(t){t.removeClass(this.options.collapsedClass),t.children("[data-action]").remove(),t.children(this.options.listNodeName).remove()},dragStart:function(t){var e=this.mouse,s=h(t.target).closest(this.options.itemNodeName),i={top:t.pageY,left:t.pageX},i=this.options.onDragStart.call(this,this.el,s,i);if(void 0===i||!1!==i){this.placeEl.css("height",s.height()),e.offsetX=t.pageX-s.offset().left,e.offsetY=t.pageY-s.offset().top,e.startX=e.lastX=t.pageX,e.startY=e.lastY=t.pageY,this.dragRootEl=this.el,this.dragParentEl=s.closest("."+this.options.listClass),this.dragEl=h(c.createElement(this.options.listNodeName)).addClass(this.options.listClass+" "+this.options.dragClass),this.dragEl.css("width",s.outerWidth()),this.setIndexOfItem(s),s.after(this.placeEl),s[0].parentNode.removeChild(s[0]),s.appendTo(this.dragEl),h(c.body).append(this.dragEl),this.dragEl.css({left:t.pageX-e.offsetX,top:t.pageY-e.offsetY});for(var o,n=this.dragEl.find(this.options.itemNodeName),l=0;l<n.length;l++)(o=h(n[l]).parents(this.options.listNodeName).length)>this.dragDepth&&(this.dragDepth=o)}},createSubLevel:function(t,e){var s=h("<"+this.options.listNodeName+"/>").addClass(this.options.listClass);return e&&s.append(e),t.append(s),this.setParent(t),s},setIndexOfItem:function(t,e){(e=e||[]).unshift(t.index()),h(t[0].parentNode)[0]!==this.dragRootEl[0]?this.setIndexOfItem(h(t[0].parentNode),e):this.dragEl.data("indexOfItem",e)},restoreItemAtIndex:function(t,e){var s=this.el,i=e.length-1;for(var o,n,l=0;l<e.length;l++){if(i===parseInt(l))return o=s,n=t,void(0===e[i]?h(o).prepend(n.clone(!0)):h(o.children[e[i]-1]).after(n.clone(!0)));var a=s[0]||s,r=a.children[e[l]],s=r||this.createSubLevel(h(a))}},dragStop:function(t){var e={top:t.pageY,left:t.pageX},s=this.dragEl.data("indexOfItem"),i=this.dragEl.children(this.options.itemNodeName).first();i[0].parentNode.removeChild(i[0]),this.dragEl.remove();t=this.options.beforeDragStop.call(this,this.el,i,this.placeEl.parent());if(void 0!==t&&!1===t){t=this.placeEl.parent();return this.placeEl.remove(),t.children().length||this.unsetParent(t.parent()),this.restoreItemAtIndex(i,s),void this.reset()}this.placeEl.replaceWith(i),this.hasNewRoot?(!0===this.options.fixed?this.restoreItemAtIndex(i,s):this.el.trigger("lostItem"),this.dragRootEl.trigger("gainedItem")):this.dragRootEl.trigger("change"),this.options.callback.call(this,this.dragRootEl,i,e),this.reset()},dragMove:function(t){var e,s=this.options,i=this.mouse;this.dragEl.css({left:t.pageX-i.offsetX,top:t.pageY-i.offsetY}),i.lastX=i.nowX,i.lastY=i.nowY,i.nowX=t.pageX,i.nowY=t.pageY,i.distX=i.nowX-i.lastX,i.distY=i.nowY-i.lastY,i.lastDirX=i.dirX,i.lastDirY=i.dirY,i.dirX=0===i.distX?0:0<i.distX?1:-1,i.dirY=0===i.distY?0:0<i.distY?1:-1;var o=Math.abs(i.distX)>Math.abs(i.distY)?1:0;if(!i.moving)return i.dirAx=o,void(i.moving=!0);s.scroll&&(void 0!==d.jQuery.fn.scrollParent?(a=!1,(n=this.el.scrollParent()[0])!==c&&"HTML"!==n.tagName?(s.scrollTriggers.bottom+n.offsetHeight-t.pageY<s.scrollSensitivity?n.scrollTop=a=n.scrollTop+s.scrollSpeed:t.pageY-s.scrollTriggers.top<s.scrollSensitivity&&(n.scrollTop=a=n.scrollTop-s.scrollSpeed),s.scrollTriggers.right+n.offsetWidth-t.pageX<s.scrollSensitivity?n.scrollLeft=a=n.scrollLeft+s.scrollSpeed:t.pageX-s.scrollTriggers.left<s.scrollSensitivity&&(n.scrollLeft=a=n.scrollLeft-s.scrollSpeed)):(t.pageY-h(c).scrollTop()<s.scrollSensitivity?a=h(c).scrollTop(h(c).scrollTop()-s.scrollSpeed):h(d).height()-(t.pageY-h(c).scrollTop())<s.scrollSensitivity&&(a=h(c).scrollTop(h(c).scrollTop()+s.scrollSpeed)),t.pageX-h(c).scrollLeft()<s.scrollSensitivity?a=h(c).scrollLeft(h(c).scrollLeft()-s.scrollSpeed):h(d).width()-(t.pageX-h(c).scrollLeft())<s.scrollSensitivity&&(a=h(c).scrollLeft(h(c).scrollLeft()+s.scrollSpeed)))):console.warn("To use scrolling you need to have scrollParent() function, check documentation for more information")),this.scrollTimer&&clearTimeout(this.scrollTimer),s.scroll&&a&&(this.scrollTimer=setTimeout(function(){h(d).trigger(t)},10)),i.dirAx!==o?(i.distAxX=0,i.distAxY=0):(i.distAxX+=Math.abs(i.distX),0!==i.dirX&&i.dirX!==i.lastDirX&&(i.distAxX=0),i.distAxY+=Math.abs(i.distY),0!==i.dirY&&i.dirY!==i.lastDirY&&(i.distAxY=0)),i.dirAx=o,i.dirAx&&i.distAxX>=s.threshold&&(i.distAxX=0,r=this.placeEl.prev(s.itemNodeName),0<i.distX&&r.length&&!r.hasClass(s.collapsedClass)&&!r.hasClass(s.noChildrenClass)&&(e=r.find(s.listNodeName).last(),this.placeEl.parents(s.listNodeName).length+this.dragDepth<=s.maxDepth&&(e.length?(e=r.children(s.listNodeName).last()).append(this.placeEl):this.createSubLevel(r,this.placeEl))),i.distX<0&&(this.placeEl.next(s.itemNodeName).length||(l=this.placeEl.parent(),this.placeEl.closest(s.itemNodeName).after(this.placeEl),l.children().length||this.unsetParent(l.parent()))));var n=!1;if(p||(this.dragEl[0].style.visibility="hidden"),this.pointEl=h(c.elementFromPoint(t.pageX-c.body.scrollLeft,t.pageY-(d.pageYOffset||c.documentElement.scrollTop))),p||(this.dragEl[0].style.visibility="visible"),this.pointEl.hasClass(s.handleClass)&&(this.pointEl=this.pointEl.closest(s.itemNodeName)),this.pointEl.hasClass(s.emptyClass))n=!0;else if(!this.pointEl.length||!this.pointEl.hasClass(s.itemClass))return;var l,a=this.pointEl.closest("."+s.rootClass),o=this.pointEl.closest("."+s.listClass),r=this.dragRootEl.data("nestable-id")!==a.data("nestable-id"),o=this.dragParentEl.data("list-id")!==o.data("list-id");i.dirAx&&!r&&!n||r&&s.group!==a.data("nestable-group")||o&&!s.moveOut||this.options.fixedDepth&&this.dragDepth+1!==this.pointEl.parents(s.listNodeName).length||this.dragDepth-1+this.pointEl.parents(s.listNodeName).length>s.maxDepth||(o=t.pageY<this.pointEl.offset().top+this.pointEl.height()/2,l=this.placeEl.parent(),n?((e=h(c.createElement(s.listNodeName)).addClass(s.listClass)).append(this.placeEl),this.pointEl.replaceWith(e)):o?this.pointEl.before(this.placeEl):this.pointEl.after(this.placeEl),l.children().length||this.unsetParent(l.parent()),this.dragRootEl.find(s.itemNodeName).length||this.appendEmptyElement(this.dragRootEl),this.dragRootEl=a,r&&(this.hasNewRoot=this.el[0]!==this.dragRootEl[0]))},appendEmptyElement:function(t){t.append('<div class="'+this.options.emptyClass+'"/>')}},h.fn.nestable=function(i){var o=this,n=arguments;return"Nestable"in d||(d.Nestable={},Nestable.counter=0),this.each(function(){var t=h(this).data("nestable");if(t){if("string"==typeof i&&"function"==typeof t[i])if(1<n.length){for(var e=[],s=1;s<n.length;s++)e.push(n[s]);o=t[i].apply(t,e)}else o=t[i]()}else Nestable.counter++,h(this).data("nestable",new l(this,i)),h(this).data("nestable-id",Nestable.counter)}),o||this}}(window.jQuery||window.Zepto,window,document);